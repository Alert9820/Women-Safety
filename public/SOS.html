<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency SOS - Guardian Angel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== ROOT VARIABLES ===== */
        :root {
            --primary: #ff3b6c;
            --secondary: #5e17eb;
            --dark: #1e1c2a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }

        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            min-height: 100vh;
        }

        /* ===== LAYOUT CONTAINER ===== */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR STYLES ===== */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--dark) 0%, #2d2b3a 100%);
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo i {
            color: var(--primary);
            font-size: 28px;
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            gap: 15px;
            background: rgba(255,255,255,0.05);
            margin: 0 15px 20px;
            border-radius: 12px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: white;
        }

        .user-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
            color: white;
        }

        .user-info p {
            font-size: 12px;
            color: var(--gray);
        }

        .nav-menu {
            flex: 1;
            padding: 10px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            border-left: 4px solid var(--primary);
            color: white;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }

        .logout-btn {
            margin: 20px;
            padding: 12px 20px;
            background: rgba(255,59,108,0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* ===== MAIN CONTENT STYLES ===== */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--dark);
        }

        /* ===== SOS MAIN SECTION ===== */
        .sos-main {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .sos-button {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 36px;
            font-weight: 700;
            box-shadow: 0 20px 50px rgba(255, 59, 108, 0.4);
            cursor: pointer;
            margin: 0 auto 30px;
            transition: all 0.3s ease;
            border: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 59, 108, 0.7);
            }
            70% {
                box-shadow: 0 0 0 30px rgba(255, 59, 108, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 59, 108, 0);
            }
        }

        .sos-button:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 60px rgba(255, 59, 108, 0.6);
        }

        .sos-instructions {
            margin: 20px 0;
            color: var(--gray);
            line-height: 1.6;
        }

        /* ===== TRIGGER OPTIONS ===== */
        .trigger-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .trigger-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .trigger-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin: 0 auto 15px;
        }

        .trigger-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-indicator.inactive {
            background: var(--gray);
        }

        /* ===== EMERGENCY CONTACTS ===== */
        .contacts-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .contact-card {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .contact-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--info);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .contact-details h4 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .contact-details p {
            font-size: 12px;
            color: var(--gray);
        }

        .remove-contact {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: auto;
        }

        .add-contact-form {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .add-contact-form input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 15px;
            }
            
            .sos-button {
                width: 200px;
                height: 200px;
                font-size: 28px;
            }
        }

        @media (max-width: 768px) {
            .trigger-options {
                grid-template-columns: 1fr;
            }
            
            .contacts-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        /* ===== NOTIFICATION STYLES ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--success);
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
            color: var(--dark);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>Guardian Angel</h1>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h3 id="userName">User</h3>
                    <p>Emergency SOS</p>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="sos.html" class="nav-item active">
                    <i class="fas fa-bell"></i>
                    <span>Emergency SOS</span>
                </a>
                <a href="location.html" class="nav-item">
                    <i class="fas fa-location-arrow"></i>
                    <span>Location Sharing</span>
                </a>
                <a href="safe-places.html" class="nav-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Safe Places</span>
                </a>
                <a href="community.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Community Alerts</span>
                </a>
                <a href="fake-call.html" class="nav-item">
                    <i class="fas fa-phone"></i>
                    <span>Fake Call</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
            
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="header">
                <h2 class="page-title">Emergency SOS</h2>
                <div class="header-actions">
                    <button class="btn btn-outline" id="testSOSBtn">
                        <i class="fas fa-vial"></i>
                        Test SOS
                    </button>
                </div>
            </div>
            
            <!-- SOS MAIN SECTION -->
            <div class="sos-main">
                <button class="sos-button" id="sosBtn">
                    SOS
                </button>
                <h2>Emergency SOS Button</h2>
                <p class="sos-instructions">
                    Press the SOS button in case of emergency. Your location will be immediately shared with all emergency contacts via SMS.
                    <br>Make sure you have added emergency contacts below.
                </p>
                
                <div class="trigger-options">
                    <div class="trigger-card">
                        <div class="trigger-icon">
                            <i class="fas fa-volume-up"></i>
                        </div>
                        <h3>Volume Button Trigger</h3>
                        <p>Press volume up/down 3 times quickly to trigger SOS</p>
                        <div class="trigger-status">
                            <div class="status-indicator" id="volumeStatus"></div>
                            <span id="volumeStatusText">Monitoring...</span>
                        </div>
                        <button class="btn btn-outline" id="toggleVolumeBtn">
                            <i class="fas fa-power-off"></i>
                            Toggle Volume SOS
                        </button>
                    </div>
                    
                    <div class="trigger-card">
                        <div class="trigger-icon">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <h3>Voice Command</h3>
                        <p>Say "Help Me" or "Emergency" to trigger SOS</p>
                        <div class="trigger-status">
                            <div class="status-indicator inactive" id="voiceStatus"></div>
                            <span id="voiceStatusText">Click to enable</span>
                        </div>
                        <button class="btn btn-outline" id="toggleVoiceBtn">
                            <i class="fas fa-microphone"></i>
                            Enable Voice
                        </button>
                    </div>
                    
                    <div class="trigger-card">
                        <div class="trigger-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Shake Detection</h3>
                        <p>Shake phone vigorously to trigger emergency</p>
                        <div class="trigger-status">
                            <div class="status-indicator inactive" id="shakeStatus"></div>
                            <span id="shakeStatusText">Click to enable</span>
                        </div>
                        <button class="btn btn-outline" id="toggleShakeBtn">
                            <i class="fas fa-power-off"></i>
                            Toggle Shake
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- EMERGENCY CONTACTS SECTION -->
            <div class="contacts-section">
                <h3 class="section-title">
                    <i class="fas fa-users"></i>
                    Emergency Contacts
                </h3>
                
                <div class="contacts-grid" id="contactsGrid">
                    <!-- Contacts will be loaded here -->
                </div>
                
                <div class="add-contact-form">
                    <input type="text" id="newContact" placeholder="Enter phone number (+91xxxxxxxxxx)" maxlength="13">
                    <button class="btn btn-primary" id="addContactBtn">
                        <i class="fas fa-plus"></i>
                        Add Contact
                    </button>
                </div>
                
                <div style="margin-top: 15px; font-size: 12px; color: var(--gray);">
                    <i class="fas fa-info-circle"></i>
                    Add up to 5 emergency contacts who will receive SOS alerts
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== SESSION MANAGEMENT =====
        document.addEventListener('DOMContentLoaded', function() {
            const userId = localStorage.getItem('userId');
            const userName = localStorage.getItem('userName');
            
            if(!userId) {
                alert('Please login first');
                window.location.href = 'index.html';
                return;
            }
            
            // Update user info
            document.getElementById('userName').textContent = userName || 'User';
            document.getElementById('userAvatar').textContent = userName ? userName.charAt(0).toUpperCase() : 'U';
            
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.clear();
                window.location.href = 'index.html';
            });
            
            // ===== EMERGENCY CONTACTS MANAGEMENT =====
            const contactsGrid = document.getElementById('contactsGrid');
            const addContactBtn = document.getElementById('addContactBtn');
            const newContactInput = document.getElementById('newContact');
            let emergencyContacts = JSON.parse(localStorage.getItem('emergencyContacts')) || [];
            
            function renderContacts() {
                contactsGrid.innerHTML = '';
                
                if(emergencyContacts.length === 0) {
                    contactsGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <h3>No Emergency Contacts</h3>
                            <p>Add contacts who will be notified during emergencies</p>
                        </div>
                    `;
                    return;
                }
                
                emergencyContacts.forEach((contact, index) => {
                    const contactCard = document.createElement('div');
                    contactCard.className = 'contact-card';
                    contactCard.innerHTML = `
                        <div class="contact-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="contact-details">
                            <h4>Emergency Contact ${index + 1}</h4>
                            <p>${contact}</p>
                        </div>
                        <button class="remove-contact" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    contactsGrid.appendChild(contactCard);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-contact').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        emergencyContacts.splice(index, 1);
                        saveContacts();
                        showNotification('Contact removed successfully', 'success');
                    });
                });
            }
            
            function saveContacts() {
                localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
                renderContacts();
                
                // Update server (if available)
                const userId = localStorage.getItem('userId');
                if(userId) {
                    fetch('/api/contacts', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({userId, contacts: emergencyContacts})
                    }).catch(err => console.log('Server sync failed'));
                }
            }
            
            addContactBtn.addEventListener('click', addContact);
            newContactInput.addEventListener('keypress', function(e) {
                if(e.key === 'Enter') addContact();
            });
            
            function addContact() {
                const number = newContactInput.value.trim();
                const phoneRegex = /^(\+91[\-\s]?)?[0]?(91)?[6789]\d{9}$/;
                
                if(!number) {
                    showNotification('Please enter a phone number', 'error');
                    return;
                }
                
                if(!phoneRegex.test(number)) {
                    showNotification('Please enter a valid Indian phone number', 'error');
                    return;
                }
                
                if(emergencyContacts.includes(number)) {
                    showNotification('This number is already in your contacts', 'error');
                    return;
                }
                
                if(emergencyContacts.length >= 5) {
                    showNotification('Maximum 5 emergency contacts allowed', 'error');
                    return;
                }
                
                emergencyContacts.push(number);
                newContactInput.value = '';
                saveContacts();
                showNotification('Contact added successfully!', 'success');
            }
            
            // ===== SOS FUNCTIONALITY =====
            const sosBtn = document.getElementById('sosBtn');
            const testSOSBtn = document.getElementById('testSOSBtn');
            
            sosBtn.addEventListener('click', triggerSOS);
            testSOSBtn.addEventListener('click', testSOS);
            
            async function triggerSOS() {
                if(emergencyContacts.length === 0) {
                    showNotification('Please add emergency contacts first!', 'error');
                    newContactInput.focus();
                    return;
                }
                
                // Button animation
                sosBtn.style.transform = 'scale(1.1)';
                sosBtn.style.boxShadow = '0 0 40px rgba(255, 59, 108, 0.8)';
                setTimeout(() => {
                    sosBtn.style.transform = 'scale(1)';
                }, 300);
                
                if(!navigator.geolocation) {
                    showNotification('Geolocation not supported by your browser', 'error');
                    return;
                }
                
                // Get current location
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    const userId = localStorage.getItem('userId');
                    
                    try {
                        const response = await fetch('/api/sos', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                userId, 
                                lat, 
                                lng, 
                                triggeredBy: 'button'
                            })
                        });
                        
                        const data = await response.json();
                        
                        if(data.success) {
                            showNotification('ðŸš¨ EMERGENCY ALERT SENT! Contacts notified.', 'success');
                            
                            // Visual feedback
                            document.body.style.background = 'linear-gradient(135deg, #ff3b6c 0%, #5e17eb 100%)';
                            setTimeout(() => {
                                document.body.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%)';
                            }, 2000);
                            
                        } else {
                            showNotification('Failed: ' + data.message, 'error');
                        }
                    } catch(error) {
                        showNotification('Network error. Please try again.', 'error');
                    }
                }, (error) => {
                    showNotification('Failed to get location. Please enable location services.', 'error');
                });
            }
            
            function testSOS() {
                showNotification('ðŸ”§ Testing SOS functionality...', 'warning');
                
                // Simulate SOS without sending actual alerts
                sosBtn.style.transform = 'scale(1.1)';
                sosBtn.style.boxShadow = '0 0 40px rgba(255, 59, 108, 0.8)';
                
                setTimeout(() => {
                    sosBtn.style.transform = 'scale(1)';
                    showNotification('âœ… SOS Test Successful! Ready for emergencies.', 'success');
                }, 1000);
            }
            
            // ===== VOLUME BUTTON SOS =====
            const volumeStatus = document.getElementById('volumeStatus');
            const volumeStatusText = document.getElementById('volumeStatusText');
            const toggleVolumeBtn = document.getElementById('toggleVolumeBtn');
            
            let volumePressCount = 0;
            let lastVolumePress = 0;
            let volumeSOSEnabled = true;
            
            toggleVolumeBtn.addEventListener('click', function() {
                volumeSOSEnabled = !volumeSOSEnabled;
                updateVolumeStatus();
            });
            
            function updateVolumeStatus() {
                if(volumeSOSEnabled) {
                    volumeStatus.className = 'status-indicator';
                    volumeStatusText.textContent = 'Monitoring...';
                    toggleVolumeBtn.innerHTML = '<i class="fas fa-power-off"></i> Disable Volume SOS';
                } else {
                    volumeStatus.className = 'status-indicator inactive';
                    volumeStatusText.textContent = 'Disabled';
                    toggleVolumeBtn.innerHTML = '<i class="fas fa-power-off"></i> Enable Volume SOS';
                }
            }
            
            document.addEventListener('keydown', function(e) {
                if(!volumeSOSEnabled) return;
                
                if(e.code === 'VolumeUp' || e.code === 'VolumeDown') {
                    const now = Date.now();
                    
                    if(now - lastVolumePress > 2000) {
                        volumePressCount = 0;
                    }
                    
                    volumePressCount++;
                    lastVolumePress = now;
                    
                    if(volumePressCount >= 3) {
                        volumePressCount = 0;
                        showNotification('Volume SOS Triggered!', 'warning');
                        triggerSOS();
                    }
                }
            });
             // ===== VOICE COMMAND SOS =====
            const voiceStatus = document.getElementById('voiceStatus');
            const voiceStatusText = document.getElementById('voiceStatusText');
            const toggleVoiceBtn = document.getElementById('toggleVoiceBtn');
            
            let voiceRecognition = null;
            let voiceSOSEnabled = false;
            
            toggleVoiceBtn.addEventListener('click', function() {
                if(!voiceSOSEnabled) {
                    enableVoiceSOS();
                } else {
                    disableVoiceSOS();
                }
            });
            
            function enableVoiceSOS() {
                if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    voiceRecognition = new SpeechRecognition();
                    
                    voiceRecognition.continuous = true;
                    voiceRecognition.interimResults = false;
                    voiceRecognition.lang = 'en-US';
                    
                    voiceRecognition.onresult = function(event) {
                        const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
                        
                        if(transcript.includes('help me') || transcript.includes('emergency') || transcript.includes('sos')) {
                            showNotification('Voice SOS Triggered!', 'warning');
                            triggerSOS();
                        }
                    };
                    
                    voiceRecognition.onerror = function(event) {
                        console.log('Voice recognition error:', event.error);
                    };
                    
                    voiceRecognition.start();
                    voiceSOSEnabled = true;
                    voiceStatus.className = 'status-indicator';
                    voiceStatusText.textContent = 'Listening...';
                    toggleVoiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Disable Voice';
                    showNotification('Voice SOS enabled. Say "Help Me" for emergency.', 'success');
                    
                } else {
                    showNotification('Voice recognition not supported in your browser', 'error');
                }
            }
            
            function disableVoiceSOS() {
                if(voiceRecognition) {
                    voiceRecognition.stop();
                }
                voiceSOSEnabled = false;
                voiceStatus.className = 'status-indicator inactive';
                voiceStatusText.textContent = 'Disabled';
                toggleVoiceBtn.innerHTML = '<i class="fas fa-microphone"></i> Enable Voice';
            }
            
            // ===== SHAKE DETECTION SOS =====
            const shakeStatus = document.getElementById('shakeStatus');
            const shakeStatusText = document.getElementById('shakeStatusText');
            const toggleShakeBtn = document.getElementById('toggleShakeBtn');
            
            let shakeSOSEnabled = false;
            let lastShake = 0;
            
            toggleShakeBtn.addEventListener('click', function() {
                shakeSOSEnabled = !shakeSOSEnabled;
                updateShakeStatus();
            });
            
            function updateShakeStatus() {
                if(shakeSOSEnabled) {
                    shakeStatus.className = 'status-indicator';
                    shakeStatusText.textContent = 'Monitoring...';
                    toggleShakeBtn.innerHTML = '<i class="fas fa-power-off"></i> Disable Shake';
                } else {
                    shakeStatus.className = 'status-indicator inactive';
                    shakeStatusText.textContent = 'Disabled';
                    toggleShakeBtn.innerHTML = '<i class="fas fa-power-off"></i> Enable Shake';
                }
            }
            
            if(window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', function(event) {
                    if(!shakeSOSEnabled) return;
                    
                    const acceleration = event.accelerationIncludingGravity;
                    const shake = Math.abs(acceleration.x) + Math.abs(acceleration.y) + Math.abs(acceleration.z);
                    
                    if(shake > 30 && Date.now() - lastShake > 2000) {
                        lastShake = Date.now();
                        showNotification('Shake SOS Triggered!', 'warning');
                        triggerSOS();
                    }
                });
            }
            
            // ===== NOTIFICATION SYSTEM =====
            function showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'bell'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if(notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
            
            // ===== INITIALIZE =====
            renderContacts();
            updateVolumeStatus();
            updateShakeStatus();
        });
    </script>
</body>
</html>
